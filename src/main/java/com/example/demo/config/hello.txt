

EmissionFactorController.java






UserController.java








entity

ActivityCategory.java






ActivityLog.java





ActivityType.java





EmissionFactor.java






User.java







exception

GlobalExceptionHandler.java





ResourceNotFoundException.java




ValidationException.java



repository



ActivityCategoryRepository.java




ActivityLogRepository.java

ActivityTypeRepository.java





EmissionFactorRepository.java 





UserRepository.java










service


ActivityCategoryService.java 




ActivityLogService.java




ActivityTypeService.java






EmissionFactorService.java




UserService.java







service/impl

ActivityCategoryServiceImpl.java




ActivityLogServiceImpl.java

package com.example.demo.service.impl;

import com.example.demo.entity.ActivityLog;
import com.example.demo.entity.ActivityType;
import com.example.demo.entity.EmissionFactor;
import com.example.demo.entity.User;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.exception.ValidationException;
import com.example.demo.repository.ActivityLogRepository;
import com.example.demo.repository.ActivityTypeRepository;
import com.example.demo.repository.EmissionFactorRepository;
import com.example.demo.repository.UserRepository;
import com.example.demo.service.ActivityLogService;
import org.springframework.stereotype.Service;

import java.time.LocalDate;
import java.time.LocalDateTime;
import java.util.List;

@Service
public class ActivityLogServiceImpl implements ActivityLogService {

private final ActivityLogRepository logRepository;
private final UserRepository userRepository;
private final ActivityTypeRepository typeRepository;
private final EmissionFactorRepository factorRepository;

public ActivityLogServiceImpl(ActivityLogRepository logRepository,
UserRepository userRepository,
ActivityTypeRepository typeRepository,
EmissionFactorRepository factorRepository) {
this.logRepository = logRepository;
this.userRepository = userRepository;
this.typeRepository = typeRepository;
this.factorRepository = factorRepository;
}

@Override
public ActivityLog logActivity(Long userId, Long typeId, ActivityLog log) {
User user = userRepository.findById(userId)
.orElseThrow(() -> new ResourceNotFoundException("User not found"));

ActivityType type = typeRepository.findById(typeId)
.orElseThrow(() -> new ResourceNotFoundException("Activity type not found"));

if (log.getQuantity() == null || log.getQuantity() <= 0) {
throw new ValidationException("Quantity must be greater than zero");
}

if (log.getActivityDate() == null) {
throw new ValidationException("Activity date is required");
}

if (log.getActivityDate().isAfter(LocalDate.now())) {
throw new ValidationException("Activity date cannot be in the future");
}

EmissionFactor factor = factorRepository.findByActivityType_Id(typeId)
.orElseThrow(() -> new ValidationException("No emission factor configured"));

Double estimated = log.getQuantity() * factor.getFactorValue();
log.setEstimatedEmission(estimated);
log.setUser(user);
log.setActivityType(type);
if (log.getLoggedAt() == null) {
log.setLoggedAt(LocalDateTime.now());
}

return logRepository.save(log);
}

@Override
public ActivityLog getLog(Long id) {
return logRepository.findById(id)
.orElseThrow(() -> new ResourceNotFoundException("Activity log not found"));
}

@Override
public List<ActivityLog> getLogsByUser(Long userId) {
return logRepository.findByUser_Id(userId);
}

@Override
public List<ActivityLog> getLogsByUserAndDate(Long userId, LocalDate start, LocalDate end) {
return logRepository.findByUser_IdAndActivityDateBetween(userId, start, end);
}
}





ActivityTypeServiceImpl.java

package com.example.demo.service.impl;

import com.example.demo.entity.ActivityCategory;
import com.example.demo.entity.ActivityType;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.exception.ValidationException;
import com.example.demo.repository.ActivityCategoryRepository;
import com.example.demo.repository.ActivityTypeRepository;
import com.example.demo.service.ActivityTypeService;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class ActivityTypeServiceImpl implements ActivityTypeService {

private final ActivityTypeRepository typeRepository;
private final ActivityCategoryRepository categoryRepository;

public ActivityTypeServiceImpl(ActivityTypeRepository typeRepository,
ActivityCategoryRepository categoryRepository) {
this.typeRepository = typeRepository;
this.categoryRepository = categoryRepository;
}

@Override
public ActivityType createType(Long categoryId, ActivityType type) {
ActivityCategory category = categoryRepository.findById(categoryId)
.orElseThrow(() -> new ResourceNotFoundException("Category not found"));

if (type.getTypeName() == null || type.getTypeName().trim().isEmpty()) {
throw new ValidationException("Type name is required");
}
if (type.getUnit() == null || type.getUnit().trim().isEmpty()) {
throw new ValidationException("Unit is required");
}

type.setCategory(category);
return typeRepository.save(type);
}

@Override
public ActivityType getType(Long id) {
return typeRepository.findById(id)
.orElseThrow(() -> new ResourceNotFoundException("Activity type not found"));
}

@Override
public List<ActivityType> getTypesByCategory(Long categoryId) {
return typeRepository.findByCategory_Id(categoryId);
}
}




EmissionFactorServiceImpl.java 

package com.example.demo.service.impl;

import com.example.demo.entity.ActivityType;
import com.example.demo.entity.EmissionFactor;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.exception.ValidationException;
import com.example.demo.repository.ActivityTypeRepository;
import com.example.demo.repository.EmissionFactorRepository;
import com.example.demo.service.EmissionFactorService;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class EmissionFactorServiceImpl implements EmissionFactorService {

private final EmissionFactorRepository factorRepository;
private final ActivityTypeRepository typeRepository;

public EmissionFactorServiceImpl(EmissionFactorRepository factorRepository,
ActivityTypeRepository typeRepository) {
this.factorRepository = factorRepository;
this.typeRepository = typeRepository;
}

@Override
public EmissionFactor createFactor(Long activityTypeId, EmissionFactor factor) {
ActivityType type = typeRepository.findById(activityTypeId)
.orElseThrow(() -> new ResourceNotFoundException("Activity type not found"));

if (factor.getFactorValue() == null || factor.getFactorValue() <= 0) {
throw new ValidationException("Factor value must be greater than zero");
}

if (factor.getUnit() == null || factor.getUnit().trim().isEmpty()) {
throw new ValidationException("Unit is required");
}

factor.setActivityType(type);
return factorRepository.save(factor);
}

@Override
public EmissionFactor getFactor(Long id) {
return factorRepository.findById(id)
.orElseThrow(() -> new ResourceNotFoundException("Emission factor not found"));
}

@Override
public EmissionFactor getFactorByType(Long activityTypeId) {
return factorRepository.findByActivityType_Id(activityTypeId)
.orElseThrow(() -> new ResourceNotFoundException("Emission factor not found"));
}

@Override
public List<EmissionFactor> getAllFactors() {
return factorRepository.findAll();
}
}



UserServiceImpl.java

package com.example.demo.service.impl;

import com.example.demo.entity.User;
import com.example.demo.exception.ResourceNotFoundException;
import com.example.demo.exception.ValidationException;
import com.example.demo.repository.UserRepository;
import com.example.demo.service.UserService;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class UserServiceImpl implements UserService {

private final UserRepository userRepository;

public UserServiceImpl(UserRepository userRepository) {
this.userRepository = userRepository;
}

@Override
public User registerUser(User user) {
if (userRepository.existsByEmail(user.getEmail())) {
throw new ValidationException("Email already in use");
}
if (user.getPassword() == null || user.getPassword().length() < 8) {
throw new ValidationException("Password must be at least 8 characters");
}
if (user.getRole() == null) {
user.setRole("USER");
}
return userRepository.save(user);
}

@Override
public User getUser(Long id) {
return userRepository.findById(id)
.orElseThrow(() -> new ResourceNotFoundException("User not found"));
}

@Override
public List<User> getAllUsers() {
return userRepository.findAll();
}

@Override
public User getByEmail(String email) {
return userRepository.findByEmail(email)
.orElseThrow(() -> new ResourceNotFoundException("User not found"));
}
}


application.properties

spring.application.name=demo
server.port=8080
spring.datasource.url=jdbc:mysql://localhost:3306/carbon_footprint_pro?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect



<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">

<modelVersion>4.0.0</modelVersion>

<parent>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-parent</artifactId>
<version>3.2.5</version>
<relativePath/>
</parent>

<groupId>com.example</groupId>
<artifactId>demo</artifactId>
<version>0.0.1-SNAPSHOT</version>
<name>demo</name>
<description>Carbon Footprint API (simple)</description>

<properties>
<!-- Use 17 unless you are sure your JDK is 21 and IDE is configured -->
<java.version>17</java.version>
</properties>

<dependencies>
<!-- Web (REST controllers) -->
<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-web</artifactId>
</dependency>

<!-- JPA / Hibernate -->
<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>

<!-- MySQL driver -->
<dependency>
<groupId>com.mysql</groupId>
<artifactId>mysql-connector-j</artifactId>
<scope>runtime</scope>
</dependency>

<!-- Swagger / OpenAPI UI -->
<dependency>
<groupId>org.springdoc</groupId>
<artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
<version>2.2.0</version>
</dependency>

<!-- Tests -->
<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-test</artifactId>
<scope>test</scope>
</dependency>
</dependencies>

<build>
<plugins>
<plugin>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-maven-plugin</artifactId>
</plugin>
</plugins>
</build>

</project>
