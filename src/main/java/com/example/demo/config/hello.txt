 DemoApplication.java



 

 

 

AuthController.java



 

 

ActivityLogController.java



 

 

UserService.java


 

 

UserServiceImpl.java

package com.example.demo.service.impl;

 

import com.example.demo.entity.User;

import com.example.demo.exception.ResourceNotFoundException;

import com.example.demo.exception.ValidationException;

import com.example.demo.repository.UserRepository;

import com.example.demo.service.UserService;

import org.springframework.stereotype.Service;

 

import java.util.List;

 

@Service

public class UserServiceImpl implements UserService {

   

    private final UserRepository userRepository;

   

    public UserServiceImpl(UserRepository userRepository) {

        this.userRepository = userRepository;

    }

   

    @Override

    public User registerUser(User user) {

        if (userRepository.existsByEmail(user.getEmail())) {

            throw new ValidationException("Email already in use");

        }

       

        if (user.getPassword().length() < 8) {

            throw new ValidationException("Password must be at least 8 characters");

        }

       

        if (user.getRole() == null || user.getRole().isEmpty()) {

            user.setRole("USER");

        }

       

        return userRepository.save(user);

    }

   

    @Override

    public User getUser(Long id) {

        return userRepository.findById(id)

                .orElseThrow(() -> new ResourceNotFoundException("User not found"));

    }

   

    @Override

    public List<User> getAllUsers() {

        return userRepository.findAll();

    }

   

    @Override

    public User getByEmail(String email) {

        return userRepository.findByEmail(email)

                .orElseThrow(() -> new ResourceNotFoundException("User not found"));

    }

   

    @Override

    public User loginUser(String email, String password) {

        User user = userRepository.findByEmail(email)

                .orElseThrow(() -> new ResourceNotFoundException("User not found"));

       

        if (!user.getPassword().equals(password)) {

            throw new ValidationException("Invalid password");

        }

       

        return user;

    }

}

 

 

application.properties

 

# Database Configuration (MySQL)

spring.datasource.url=jdbc:mysql://localhost:3306/carbon_footprint_db?createDatabaseIfNotExist=true

spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.datasource.username=root

spring.datasource.password=root

 

# JPA Configuration

spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect

spring.jpa.hibernate.ddl-auto=update

spring.jpa.show-sql=true

 

# Server Configuration

server.port=8081

 

 

 