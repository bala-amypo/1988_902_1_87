
Folder:Repository

 

 

 

 

 

 

ActivityLogRepository.java



 

 

 

 

ActivityTypeRepository.java


 

 

EmissionFactorRepository.java



 

 

 

UserRepository.java



 

 

Folder : Security

 

CustomUserDetailsService.java



 

 

JwtAuthenticationFilter.java

 



 

 

 

 

 

JwtUtil.java



 

 

 

 

Folder: Service

ActivityCategoryService.java

package com.example.demo.service;

 

import com.example.demo.entity.ActivityCategory;

import java.util.List;

 

public interface ActivityCategoryService {

    ActivityCategory createCategory(ActivityCategory category);

    ActivityCategory getCategory(Long id);

    List<ActivityCategory> getAllCategories();

}

 

 

 

ActivityLogService.java

package com.example.demo.service;

 

import com.example.demo.entity.ActivityLog;

import java.time.LocalDate;

import java.util.List;

public interface ActivityLogService {

    ActivityLog logActivity(Long userId, Long typeId, ActivityLog log);

    List<ActivityLog> getLogsByUser(Long userId);

    List<ActivityLog> getLogsByUserAndDate(Long userId, LocalDate start, LocalDate end);

    ActivityLog getLog(Long id);

}

 

 

 


ActivityTypeService.java

package com.example.demo.service;

import com.example.demo.entity.ActivityType;

import java.util.List;

 

public interface ActivityTypeService {

    ActivityType createType(Long categoryId, ActivityType type);

    ActivityType getType(Long id);

    List<ActivityType> getTypesByCategory(Long categoryId);

}

 

 

 

 

 



EmissionFactorService.java 

package com.example.demo.service;

 

import com.example.demo.entity.EmissionFactor;

import java.util.List;

 

public interface EmissionFactorService {

    EmissionFactor createFactor(Long activityTypeId, EmissionFactor factor);

    EmissionFactor getFactor(Long id);

    EmissionFactor getFactorByType(Long typeId);

    List<EmissionFactor> getAllFactors();

}

 

 

 

 

UserService.java

 

package com.example.demo.service;

 

import com.example.demo.entity.User;

import java.util.List;

 

public interface UserService {

    User registerUser(User user);

    User getUser(Long id);

    List<User> getAllUsers();

    User getByEmail(String email);

}

 

 

Folder Service/impl


ActivityCategoryServiceImpl.java

package com.example.demo.service.impl;

 

import com.example.demo.entity.ActivityCategory;

import com.example.demo.exception.ResourceNotFoundException;

import com.example.demo.exception.ValidationException;

import com.example.demo.repository.ActivityCategoryRepository;

import com.example.demo.service.ActivityCategoryService;

import org.springframework.stereotype.Service;

 

import java.util.List;

 

@Service

public class ActivityCategoryServiceImpl implements ActivityCategoryService {

   

    private final ActivityCategoryRepository categoryRepository;

   

    public ActivityCategoryServiceImpl(ActivityCategoryRepository categoryRepository) {

        this.categoryRepository = categoryRepository;

    }

   

    @Override

    public ActivityCategory createCategory(ActivityCategory category) {

        if (categoryRepository.existsByCategoryName(category.getCategoryName())) {

            throw new ValidationException("Category name must be unique");

        }

        return categoryRepository.save(category);

    }

   

    @Override

    public ActivityCategory getCategory(Long id) {

        return categoryRepository.findById(id)

                .orElseThrow(() -> new ResourceNotFoundException("Category not found"));

    }

   

    @Override

    public List<ActivityCategory> getAllCategories() {

        return categoryRepository.findAll();

    }

}

 

 

 

 

ActivityLogServiceImpl.java

package com.example.demo.service.impl;

import com.example.demo.entity.ActivityLog;

import com.example.demo.entity.ActivityType;

import com.example.demo.entity.EmissionFactor;

import com.example.demo.entity.User;

import com.example.demo.exception.ResourceNotFoundException;

import com.example.demo.exception.ValidationException;

import com.example.demo.repository.ActivityLogRepository;

import com.example.demo.repository.ActivityTypeRepository;

import com.example.demo.repository.EmissionFactorRepository;

import com.example.demo.repository.UserRepository;

import com.example.demo.service.ActivityLogService;

import org.springframework.stereotype.Service;

 

import java.time.LocalDate;

import java.util.List;

 

@Service

public class ActivityLogServiceImpl implements ActivityLogService {

   

    private final ActivityLogRepository logRepository;

    private final UserRepository userRepository;

    private final ActivityTypeRepository typeRepository;

    private final EmissionFactorRepository factorRepository;

   

    public ActivityLogServiceImpl(ActivityLogRepository logRepository, UserRepository userRepository,

                                 ActivityTypeRepository typeRepository, EmissionFactorRepository factorRepository) {

        this.logRepository = logRepository;

        this.userRepository = userRepository;

        this.typeRepository = typeRepository;

        this.factorRepository = factorRepository;

    }

   

    @Override

    public ActivityLog logActivity(Long userId, Long typeId, ActivityLog log) {

        User user = userRepository.findById(userId)

                .orElseThrow(() -> new ResourceNotFoundException("User not found"));

       

        ActivityType activityType = typeRepository.findById(typeId)

                .orElseThrow(() -> new ResourceNotFoundException("Category not found"));

       

        if (log.getActivityDate().isAfter(LocalDate.now())) {

            throw new ValidationException("Activity date cannot be in the future");

        }

       

        if (log.getQuantity() <= 0) {

            throw new ValidationException("Quantity must be greater than zero");

        }

       

        EmissionFactor factor = factorRepository.findByActivityType_Id(typeId)

                .orElseThrow(() -> new ValidationException("No emission factor configured"));

       

        log.setUser(user);

        log.setActivityType(activityType);

        log.setEstimatedEmission(log.getQuantity() * factor.getFactorValue());

       

        return logRepository.save(log);

    }

   

    @Override

    public List<ActivityLog> getLogsByUser(Long userId) {

        return logRepository.findByUser_Id(userId);

    }

   

    @Override

    public List<ActivityLog> getLogsByUserAndDate(Long userId, LocalDate start, LocalDate end) {

        return logRepository.findByUser_IdAndActivityDateBetween(userId, start, end);

    }

   

    @Override

    public ActivityLog getLog(Long id) {

        return logRepository.findById(id)

                .orElseThrow(() -> new ResourceNotFoundException("Activity log not found"));

    }

}

 

 

 

 

 

 

ActivityTypeServiceImpl.java

package com.example.demo.service.impl;

 

import com.example.demo.entity.ActivityCategory;

import com.example.demo.entity.ActivityType;

import com.example.demo.exception.ResourceNotFoundException;

import com.example.demo.exception.ValidationException;

import com.example.demo.repository.ActivityCategoryRepository;

import com.example.demo.repository.ActivityTypeRepository;

import com.example.demo.service.ActivityTypeService;

import org.springframework.stereotype.Service;

 

import java.util.List;

 

@Service

public class ActivityTypeServiceImpl implements ActivityTypeService {

   

    private final ActivityTypeRepository typeRepository;

    private final ActivityCategoryRepository categoryRepository;

   

    public ActivityTypeServiceImpl(ActivityTypeRepository typeRepository, ActivityCategoryRepository categoryRepository) {

        this.typeRepository = typeRepository;

        this.categoryRepository = categoryRepository;

    }

   

    @Override

    public ActivityType createType(Long categoryId, ActivityType type) {

        ActivityCategory category = categoryRepository.findById(categoryId)

                .orElseThrow(() -> new ResourceNotFoundException("Category not found"));

       

        if (type.getUnit() == null || type.getUnit().trim().isEmpty()) {

            throw new ValidationException("Unit must be provided");

        }

       

        type.setCategory(category);

        return typeRepository.save(type);

    }

   

    @Override

    public ActivityType getType(Long id) {

        return typeRepository.findById(id)

                .orElseThrow(() -> new ResourceNotFoundException("Activity type not found"));

    }

   

    @Override

    public List<ActivityType> getTypesByCategory(Long categoryId) {

        return typeRepository.findByCategory_Id(categoryId);

    }

}

 

 

 

 





EmissionFactorServiceImpl.java

package com.example.demo.service.impl;

 

import com.example.demo.entity.ActivityType;

import com.example.demo.entity.EmissionFactor;

import com.example.demo.exception.ResourceNotFoundException;

import com.example.demo.exception.ValidationException;

import com.example.demo.repository.ActivityTypeRepository;

import com.example.demo.repository.EmissionFactorRepository;

import com.example.demo.service.EmissionFactorService;

import org.springframework.stereotype.Service;

 

import java.util.List;

 

@Service

public class EmissionFactorServiceImpl implements EmissionFactorService {

   

    private final EmissionFactorRepository factorRepository;

    private final ActivityTypeRepository typeRepository;

   

    public EmissionFactorServiceImpl(EmissionFactorRepository factorRepository, ActivityTypeRepository typeRepository) {

        this.factorRepository = factorRepository;

        this.typeRepository = typeRepository;

    }

   

    @Override

    public EmissionFactor createFactor(Long activityTypeId, EmissionFactor factor) {

        ActivityType activityType = typeRepository.findById(activityTypeId)

                .orElseThrow(() -> new ResourceNotFoundException("Category not found"));

       

        if (factor.getFactorValue() <= 0) {

            throw new ValidationException("Factor value must be greater than zero");

        }

       

        factor.setActivityType(activityType);

        return factorRepository.save(factor);

    }

   

    @Override

    public EmissionFactor getFactor(Long id) {

        return factorRepository.findById(id)

                .orElseThrow(() -> new ResourceNotFoundException("Emission factor not found"));

    }

   

    @Override

    public EmissionFactor getFactorByType(Long typeId) {

        return factorRepository.findByActivityType_Id(typeId)

                .orElseThrow(() -> new ResourceNotFoundException("Emission factor not found"));

    }

   

    @Override

    public List<EmissionFactor> getAllFactors() {

        return factorRepository.findAll();

    }

}

 

 

 

 





UserServiceImpl.java

package com.example.demo.service.impl;

 

import com.example.demo.entity.User;

import com.example.demo.exception.ResourceNotFoundException;

import com.example.demo.exception.ValidationException;

import com.example.demo.repository.UserRepository;

import com.example.demo.service.UserService;

import org.springframework.security.crypto.password.PasswordEncoder;

import org.springframework.stereotype.Service;

 

import java.util.List;

 

@Service

public class UserServiceImpl implements UserService {

   

    private final UserRepository userRepository;

    private final PasswordEncoder passwordEncoder;

   

    public UserServiceImpl(UserRepository userRepository, PasswordEncoder passwordEncoder) {

        this.userRepository = userRepository;

        this.passwordEncoder = passwordEncoder;

    }

   

    @Override

    public User registerUser(User user) {

        if (userRepository.existsByEmail(user.getEmail())) {

            throw new ValidationException("Email already in use");

        }

       

        if (user.getPassword().length() < 8) {

            throw new ValidationException("Password must be at least 8 characters");

        }

       

        user.setPassword(passwordEncoder.encode(user.getPassword()));

       

        if (user.getRole() == null || user.getRole().isEmpty()) {

            user.setRole("USER");

        }

       

        return userRepository.save(user);

    }

   

    @Override

    public User getUser(Long id) {

        return userRepository.findById(id)

                .orElseThrow(() -> new ResourceNotFoundException("User not found"));

    }

   

    @Override

    public List<User> getAllUsers() {

        return userRepository.findAll();

    }

   

    @Override

    public User getByEmail(String email) {

        return userRepository.findByEmail(email)

                .orElseThrow(() -> new ResourceNotFoundException("User not found"));

    }

}

 

 






Application.properties

# Database Configuration (H2 for testing)

spring.datasource.url=jdbc:h2:mem:testdb

spring.datasource.driver-class-name=org.h2.Driver

spring.datasource.username=sa

spring.datasource.password=password

 

# JPA Configuration

spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

spring.jpa.hibernate.ddl-auto=create-drop

spring.jpa.show-sql=true

 

# H2 Console (for debugging)

spring.h2.console.enabled=true

 

# Server Configuration

server.port=8081

 

# Swagger Configuration

springdoc.api-docs.path=/v3/api-docs

springdoc.swagger-ui.path=/swagger-ui.html

 

 

 





pom.xml

<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"

    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">

    <modelVersion>4.0.0</modelVersion>

    <parent>

        <groupId>org.springframework.boot</groupId>

        <artifactId>spring-boot-starter-parent</artifactId>

        <version>3.2.0</version>

        <relativePath/> <!-- lookup parent from repository -->

    </parent>

    <groupId>com.example</groupId>

    <artifactId>demo</artifactId>

    <version>0.0.1-SNAPSHOT</version>

    <name>demo</name>

    <description>Demo project for Spring Boot</description>

    <properties>

        <java.version>17</java.version>

    </properties>

    <dependencies>

        <dependency>

            <groupId>org.springframework.boot</groupId>

            <artifactId>spring-boot-starter-data-jpa</artifactId>

        </dependency>

        <dependency>

            <groupId>org.springframework.boot</groupId>

            <artifactId>spring-boot-starter-web</artifactId>

        </dependency>

        <dependency>

            <groupId>org.springframework.boot</groupId>

            <artifactId>spring-boot-starter-security</artifactId>

        </dependency>

        <dependency>

            <groupId>org.springframework.boot</groupId>

            <artifactId>spring-boot-starter-validation</artifactId>

        </dependency>

        <dependency>

            <groupId>io.jsonwebtoken</groupId>

            <artifactId>jjwt-api</artifactId>

            <version>0.11.5</version>

        </dependency>

        <dependency>

            <groupId>io.jsonwebtoken</groupId>

            <artifactId>jjwt-impl</artifactId>

            <version>0.11.5</version>

            <scope>runtime</scope>

        </dependency>

        <dependency>

            <groupId>io.jsonwebtoken</groupId>

            <artifactId>jjwt-jackson</artifactId>

            <version>0.11.5</version>

            <scope>runtime</scope>

        </dependency>

        <dependency>

            <groupId>org.springdoc</groupId>

            <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>

            <version>2.2.0</version>

        </dependency>

        <dependency>

            <groupId>com.h2database</groupId>

            <artifactId>h2</artifactId>

            <scope>runtime</scope>

        </dependency>

        <dependency>

            <groupId>com.mysql</groupId>

            <artifactId>mysql-connector-j</artifactId>

            <scope>runtime</scope>

        </dependency>

        <dependency>

            <groupId>org.springframework.boot</groupId>

            <artifactId>spring-boot-starter-test</artifactId>

            <scope>test</scope>

        </dependency>

        <dependency>

            <groupId>org.springframework.security</groupId>

            <artifactId>spring-security-test</artifactId>

            <scope>test</scope>

        </dependency>

    </dependencies>

 

    <build>

        <plugins>

            <plugin>

                <groupId>org.springframework.boot</groupId>

                <artifactId>spring-boot-maven-plugin</artifactId>

            </plugin>

        </plugins>

    </build>

 

</project>

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 

 